<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js" integrity="sha512-bZS47S7sPOxkjU/4Bt0zrhEtWx0y0CRkhEp8IckzK+ltifIIE9EMIMTuT/mEzoIMewUINruDBIR/jJnbguonqQ==" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/vue@3"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body id="app">
<div class="container mx-auto  p-5">

  <h2 class="text-xl text-center mb-5 font-semibold">Plan</h2>


    <div class="flex items-center w-3/4 mx-auto">
      <input type="range" min="3" max="1000" v-model="listings" class="w-full">
      <input type="number" min="3" max="1000"  v-model="listings" class="border w-16 ml-3">
    </div>


  <div class="grid grid-cols-3 gap-6 mt-8">


    <div class="block p-5 border ">
      <p class="text-xl font-semibold text-center">On time Custom</p>
      <p class="text-center"> Listings {{listings}}</p>
      <p class="text-center text-2xl">${{(listings*oneTimeBase*(100-discount.onetime)/100).toFixed(2)}}  <strike>${{(oneTimeBase*listings).toFixed(2)}}</strike></p>

      <p v-if="discount.onetime!=0" class="text-center text-sm">Discount {{discount.onetime}}%</p>
      <p v-if="discount.onetime!=0" class="text-center text-sm">Your saving ${{(listings*oneTimeBase*discount.onetime/100).toFixed(2)}}</p>

      <button @click="buyNow('ONETIME')" class="text-center border px-5 py-1 mx-auto block mt-2 bg-purple-600 text-white hover:bg-purple-400">Buy</button>

    </div>

    <div class="block p-5 border ">
      <p class="text-xl font-semibold text-center">Subscribe Custom</p>
      <p class="text-center"> Listings {{listings}}</p>
      <p class="text-center text-2xl">${{(listings*subscriptionBase*(100-discount.monthly)/100).toFixed(2)}} <strike  class="text-sm">${{listings*subscriptionBase}}</strike></p>

      <p v-if="discount.monthly!=0" class="text-center text-sm">Discount {{discount.monthly}}%</p>
      <p v-if="discount.monthly!=0" class="text-center text-sm">Your saving ${{(listings*subscriptionBase*discount.monthly/100).toFixed(2)}}</p>

      <div class="flex items-center justify-between">
        <button @click="buyNow('MONTHLY')" class="text-center border px-5 py-1 mx-auto block mt-2 bg-purple-600 text-white hover:bg-purple-400">Buy</button>
        <button @click="changePlan('MONTHLY')" class="text-center border px-5 py-1 mx-auto block mt-2 bg-purple-600 text-white hover:bg-purple-400">Change Plan</button>
      </div>

    </div>

    <div class="block p-5 border ">
      <p class="text-xl font-semibold text-center">Subscribe Custom</p>
      <p class="text-center"> Listings {{listings}}</p>
      <p class="text-center text-2xl">${{(listings*subscriptionBase*12*(100-discount.yearly)/100).toFixed(2)}}<strike class="text-sm">${{listings*subscriptionBase*12}}</strike></p>

      <p class="text-center text-sm">Discount {{discount.yearly}}%</p>
      <p class="text-center text-sm">Your saving ${{(listings*subscriptionBase*discount.yearly*12/100).toFixed(2)}}</p>

      <div class="flex items-center justify-between">
        <button @click="buyNow('YEARLY')" class="text-center border px-5 py-1 mx-auto block mt-2 bg-purple-600 text-white hover:bg-purple-400">Buy</button>
        <button @click="changePlan('YEARLY')" class="text-center border px-5 py-1 mx-auto block mt-2 bg-purple-600 text-white hover:bg-purple-400">Change Plan</button>
      </div>

    </div>

  </div>


  <h2 class="text-xl text-center my-5 font-semibold">Billing</h2>

  <div>
    <form @submit.prevent="gotoBilling" class="mx-auto w-2/4">
      <label for="" class="block text-center">Customer ID</label>
      <input type="text" v-model="subscriptionID" class="border w-full">
      <button class="text-center border px-5 py-1 mx-auto block mt-2 bg-purple-600 text-white hover:bg-purple-400">View</button>
    </form>
  </div>


</div>
<script>
  const { createApp } = Vue
  const ONETIME_BASE=6
  const SUBSCRIPTION_BASE=5
  createApp({
    data() {
      return {
        listings: 3,
        maxListings:1000,
        minListings: 3,
        oneTimeBase: 6,
        subscriptionBase:5,
        discount: {
          onetime: 0,
          monthly: 0,
          yearly: 8.33
        },
        subscriptionID:"cus_LsOpqRYcYZW2Vs"
      }
    },
    methods:{
      buyNow(freq){
        //freq can be ONETIME, MONTHLY, YEARLY
        let data={
          freq,
          qty:this.listings
        }
        axios.post('/create-checkout-session',data).then(res=>{
          window.open(res.data.url);
        }).catch(err=>console.error(err))
      },
      changePlan(freq){
        //freq can be ONE, MONTHLY, YEARLY
        let data={
          freq,
          qty:this.listings
        }
        axios.post('/change-subscription',data).then(res=>{
          console.log(res.data)
        }).catch(err=>console.error(err))
      },
      gotoBilling(){
        axios.get(`/billing/${this.subscriptionID}`).then(res=>{
          console.log(res.data.data)
          window.open(res.data.data.url);
        }).catch(err=>console.log(err))
      }
    },
    watch:{
      listings (){

        if (this.listings < 4) {
          this.discount.onetime = 0
        } else if (this.listings < 7) {
          this.discount.onetime = 8.33
        } else if (this.listings < 51) {
          this.discount.onetime = 16.67
        } else {
          this.discount.onetime = 25
        }

        if (this.listings < 6) {
          this.discount.monthly = 0
          this.discount.yearly = 8.33
        } else if (this.listings < 21) {
          this.discount.monthly = 10
          this.discount.yearly = 17.56
        } else if (this.listings < 101) {
          this.discount.monthly = 20
          this.discount.yearly = 26.72
        } else {
          this.discount.monthly = 30
          this.discount.yearly = 35.83
        }
      }
    }
  }).mount('#app')
</script>
</body>
</html>
